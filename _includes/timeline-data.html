{%- comment -%}
GitHubé£æ ¼å¹´åº¦è´¡çŒ®çƒ­åŠ›å›¾æ•°æ®ç”Ÿæˆå™¨
æ ¹æ®ç½‘ç«™çš„Postsã€Notesã€Storiesè®¡ç®—æ¯æ—¥æ´»è·ƒåº¦ï¼Œç”ŸæˆJSONæ•°æ®ä¾›å‰ç«¯ä½¿ç”¨
{%- endcomment -%}

{%- assign current_year = "now" | date: "%Y" | plus: 0 -%}
{%- assign timeline_data = "" -%}
{%- assign year_start = current_year | append: "-01-01" -%}

{%- comment -%}
æ´»è·ƒåº¦æƒé‡è®¾ç½®ï¼š
- Posts: 3åˆ† (é‡è¦å†…å®¹ï¼Œæƒé‡æœ€é«˜)
- Stories: 2åˆ† (å›¾ç‰‡æ•…äº‹ï¼Œä¸­ç­‰æƒé‡)  
- Notes: 1åˆ† (æ—¥å¸¸ç¬”è®°ï¼ŒåŸºç¡€æƒé‡)

é¢œè‰²ç­‰çº§åˆ’åˆ†ï¼š
- Level 0: 0åˆ† (æ— æ´»åŠ¨)
- Level 1: 1-2åˆ† (è½»åº¦æ´»è·ƒ)
- Level 2: 3-5åˆ† (ä¸­åº¦æ´»è·ƒ)  
- Level 3: 6-9åˆ† (é«˜åº¦æ´»è·ƒ)
- Level 4: 10+åˆ† (æåº¦æ´»è·ƒ)
{%- endcomment -%}

{%- for day_offset in (0..364) -%}
  {%- assign days_since_epoch = year_start | date: "%s" | divided_by: 86400 | plus: day_offset -%}
  {%- assign check_date = days_since_epoch | times: 86400 | date: "%Y-%m-%d" -%}
  {%- assign activity_count = 0 -%}
  
  {%- comment -%} ç»Ÿè®¡å½“æ—¥Posts {%- endcomment -%}
  {%- for post in site.posts -%}
    {%- assign post_date = post.date | date: "%Y-%m-%d" -%}
    {%- if post_date == check_date -%}
      {%- assign activity_count = activity_count | plus: 3 -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- comment -%} ç»Ÿè®¡å½“æ—¥Notes {%- endcomment -%}
  {%- for note in site.notes -%}
    {%- assign note_date = note.date | date: "%Y-%m-%d" -%}
    {%- if note_date == check_date -%}
      {%- assign activity_count = activity_count | plus: 1 -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- comment -%} ç»Ÿè®¡å½“æ—¥Stories {%- endcomment -%}
  {%- for story in site.stories -%}
    {%- assign story_date = story.date | date: "%Y-%m-%d" -%}
    {%- if story_date == check_date -%}
      {%- assign activity_count = activity_count | plus: 2 -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- comment -%} å°†æ´»è·ƒåº¦è½¬æ¢ä¸ºGitHubé£æ ¼çš„é¢œè‰²ç­‰çº§ {%- endcomment -%}
  {%- assign color_level = 0 -%}
  {%- if activity_count >= 1 -%}
    {%- assign color_level = 1 -%}
  {%- endif -%}
  {%- if activity_count >= 3 -%}
    {%- assign color_level = 2 -%}
  {%- endif -%}
  {%- if activity_count >= 6 -%}
    {%- assign color_level = 3 -%}
  {%- endif -%}
  {%- if activity_count >= 10 -%}
    {%- assign color_level = 4 -%}
  {%- endif -%}
  
  {%- comment -%} æ„é€ JSONæ•°æ® {%- endcomment -%}
  {%- assign day_data = '{"date":"' | append: check_date | append: '","count":' | append: activity_count | append: ',"level":' | append: color_level | append: '}' -%}
  
  {%- if day_offset == 0 -%}
    {%- assign timeline_data = day_data -%}
  {%- else -%}
    {%- assign timeline_data = timeline_data | append: ',' | append: day_data -%}
  {%- endif -%}
{%- endfor -%}

<script>
  // å…¨å±€æ—¶é—´è½´æ•°æ®ï¼Œä¾›å¹´åº¦çƒ­åŠ›å›¾ä½¿ç”¨
  window.timelineData = [{{ timeline_data }}];
  
  // å¼€å‘ç¯å¢ƒè°ƒè¯•ä¿¡æ¯
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    console.log('ğŸ“Š Timeline data loaded:', window.timelineData.length, 'days');
    
    const totalContributions = window.timelineData.reduce((sum, day) => sum + day.count, 0);
    const activeDays = window.timelineData.filter(day => day.count > 0).length;
    
    console.log('ğŸ“ˆ Total contributions:', totalContributions);
    console.log('ğŸ—“ï¸ Active days:', activeDays);
    console.log('ğŸ“… Sample data:', window.timelineData.slice(0, 5));
  }
</script>