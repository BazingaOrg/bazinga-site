# Umami 分析功能配置指南

## 🎯 功能概述

已为你的 Jekyll 网站成功集成了 Umami 分析功能，包含以下特性：

### 1. 基础页面追踪
- ✅ 自动追踪所有页面访问
- ✅ 多语言页面区分 (en-US/zh-CN)
- ✅ 页面类型识别 (posts/notes/stories/pages/photos/film)
- ✅ 页面标题和 URL 追踪

### 2. 自定义事件追踪
- ✅ 点赞/取消点赞事件
- ✅ 语言切换事件
- ✅ RSS 订阅链接点击
- ✅ 标签筛选点击
- ✅ 照片点击事件
- ✅ 外部链接点击

### 3. 错误处理和兼容性
- ✅ 安全初始化，避免脚本未加载时的错误
- ✅ 广告拦截器兼容性
- ✅ 优雅降级，不影响网站正常功能

## 📊 数据分析仪表板使用指南

### 1. 登录 Umami 仪表板
访问：https://cloud.umami.is/
使用你的账号登录

### 2. 设置有用的仪表板视图

#### 语言分析视图
1. 创建新仪表板：`语言分析`
2. 添加图表：
   - 页面访问量（按语言分组）
   - 事件数量（按语言分组）
   - 设备类型（按语言分组）

#### 内容类型分析视图
1. 创建新仪表板：`内容分析`
2. 添加图表：
   - 页面访问量（按页面类型分组）
   - 点赞事件（按内容类型分组）
   - 页面停留时间（按页面类型分组）

#### 用户行为分析视图
1. 创建新仪表板：`用户行为`
2. 添加图表：
   - 自定义事件概览
   - 外部链接点击排行
   - RSS 订阅点击统计

### 3. 重要事件说明

#### 事件类型和参数

**语言切换事件**
```
事件名：language_switch
参数：
- from_language: 切换前语言
- to_language: 切换后语言
- current_page: 当前页面
- target_page: 目标页面
```

**点赞事件**
```
事件名：like
参数：
- content_type: 内容类型 (posts/notes/stories/pages)
- content_url: 内容 URL
- content_title: 内容标题
- language: 语言
```

**RSS 订阅点击**
```
事件名：rss_click
参数：
- rss_type: RSS 类型 (feed/notes/photos/stories/film)
- current_page: 当前页面
- language: 语言
```

**标签点击**
```
事件名：tag_click
参数：
- tag: 标签名称
- current_page: 当前页面
- language: 语言
```

**照片点击**
```
事件名：photo_click
参数：
- photo_id: 照片 ID
- current_page: 当前页面
- language: 语言
```

**外部链接点击**
```
事件名：external_link_click
参数：
- destination: 目标 URL
- link_text: 链接文本
- current_page: 当前页面
- language: 语言
```

### 4. 数据分析建议

#### 内容优化分析
1. **最受欢迎的内容类型**：查看按 `page_type` 分组的页面访问量
2. **语言偏好**：分析中英文页面的访问比例
3. **用户参与度**：通过点赞事件分析内容受欢迎程度
4. **内容路径**：分析用户在不同内容类型间的跳转

#### 功能使用分析
1. **语言切换频率**：了解用户对多语言功能的使用情况
2. **RSS 订阅效果**：分析不同 RSS 源的订阅点击
3. **外部链接引流**：了解用户点击的外部资源
4. **标签筛选使用**：分析标签功能的实用性

#### 用户行为分析
1. **设备偏好**：了解用户使用的设备类型
2. **地理位置**：分析用户的地域分布
3. **访问时间**：了解用户的访问时间规律
4. **停留时间**：分析不同页面的用户停留时间

### 5. 测试验证

#### 测试页面
访问：`https://site.bazinga.ink/umami-test/`
此页面包含所有追踪功能的测试元素：
- 基础页面访问追踪
- 语言切换链接
- 点赞功能
- RSS 订阅链接
- 外部链接
- 自定义事件测试按钮

#### 验证步骤
1. 访问测试页面
2. 点击各个测试元素
3. 在 Umami 仪表板中查看实时数据
4. 确认事件是否正确记录

#### 注意事项
如果测试时出现 "umami 未加载" 提示，可能是由于：
- 广告拦截器阻止了 umami 脚本加载
- 网络连接问题
- 浏览器扩展冲突

这是正常现象，不会影响网站的正常功能。在生产环境中，大部分用户不会被影响。

### 6. 常见问题

**Q: 为什么测试时 umami 脚本无法加载？**
A: 可能是由于广告拦截器（如 uBlock Origin）阻止了分析脚本的加载。这在开发环境中很常见，但生产环境中大部分用户不会受到影响。

**Q: 数据为什么有延迟？**
A: Umami 数据通常有几分钟的延迟，这是正常现象。

**Q: 如何提高数据准确性？**
A: 确保网站正确部署，umami 脚本能够正常加载，并定期检查数据质量。

## 🔧 技术实现细节

### 集成文件
- 主要配置：`_layouts/default.html`
- 测试页面：`_pages/umami-test.md`
- Website ID：`a9c48eab-814c-4ebc-bb56-b0336f0dc427`

### 脚本位置
Umami 脚本位于 `</body>` 标签前，确保不影响页面加载性能。

### 事件监听器
所有事件监听器都使用事件委托，确保动态加载的内容也能被追踪。

### 错误处理和兼容性
- **安全初始化**：使用 `window.umami = window.umami || []` 安全初始化
- **错误捕获**：所有追踪调用都包装在 try-catch 中
- **广告拦截器兼容**：即使脚本被阻止也不会影响网站功能
- **优雅降级**：当 umami 不可用时静默失败

---

## 📈 后续优化建议

1. **添加更多事件**：根据需要添加更多用户行为追踪
2. **A/B 测试**：使用 Umami 进行简单的 A/B 测试
3. **转化目标**：设置转化目标追踪重要用户行为
4. **自定义维度**：根据业务需求添加更多自定义维度
5. **定期审查**：定期检查数据质量和追踪效果

现在你的网站已经具备了完整的分析功能，可以在 Umami 仪表板中深入了解用户行为和内容表现！