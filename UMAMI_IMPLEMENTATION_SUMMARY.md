# ğŸ”§ å®Œæ•´çš„ Umami åˆ†æç³»ç»Ÿå®æ–½æ€»ç»“

## ğŸ“‹ å·²å®æ–½çš„åŠŸèƒ½æ¨¡å—

### 1. âœ… æ ¸å¿ƒ HTML å±æ€§è¿½è¸ª
- **ä½ç½®**: `_layouts/default.html`, `index.html`, `index-zh-CN.html`
- **åŠŸèƒ½**: åŸºäº HTML æ•°æ®å±æ€§çš„é›¶ JavaScript äº‹ä»¶è¿½è¸ª
- **æ¶µç›–**: å¯¼èˆªç‚¹å‡»ã€RSS é“¾æ¥ã€ç…§ç‰‡æµè§ˆã€è¯­è¨€åˆ‡æ¢

### 2. âœ… è¡¨å•äº¤äº’è¿½è¸ª (`assets/form-tracking.js`)
- **åŠŸèƒ½**: å®Œæ•´çš„å†™ä½œè¡¨å•è¡Œä¸ºåˆ†æ
- **è¿½è¸ªæŒ‡æ ‡**:
  - è¡¨å•ç”Ÿå‘½å‘¨æœŸ (å¼€å§‹ã€æäº¤ã€æˆåŠŸ/å¤±è´¥)
  - å­—æ®µäº¤äº’æ¨¡å¼ (ç„¦ç‚¹æ—¶é—´ã€ä¿®æ”¹æ¬¡æ•°)
  - æ ‡ç­¾é€‰æ‹©è¡Œä¸º
  - é¢„è§ˆä½¿ç”¨æƒ…å†µ
  - è¡¨å•æ”¾å¼ƒæ£€æµ‹

### 3. âœ… Stories æµè§ˆè¡Œä¸ºè¿½è¸ª (`assets/stories-tracking.js`)
- **åŠŸèƒ½**: Stories ç»„ä»¶æ·±åº¦äº¤äº’åˆ†æ
- **è¿½è¸ªæŒ‡æ ‡**:
  - è§†å£è§‚å¯Ÿå’Œæ»šåŠ¨è¡Œä¸º
  - æ‰‹åŠ¿è¯†åˆ« (ç‚¹å‡»ã€æ»‘åŠ¨ã€é•¿æŒ‰)
  - Stories åŠ è½½æ€§èƒ½
  - ä¼šè¯çº§æµè§ˆæ‘˜è¦

### 4. âœ… æ€§èƒ½æŒ‡æ ‡è¿½è¸ª (`assets/performance-tracking.js`)
- **åŠŸèƒ½**: å…¨é¢çš„ Core Web Vitals å’Œæ€§èƒ½ç›‘æ§
- **è¿½è¸ªæŒ‡æ ‡**:
  - LCP, FID, CLS, TTFB, FCP, INP
  - èµ„æºåŠ è½½æ€§èƒ½
  - å†…å­˜ä½¿ç”¨ç›‘æ§
  - JavaScript é”™è¯¯è¿½è¸ª
  - è®¾å¤‡å’Œç½‘ç»œä¿¡æ¯

### 5. âœ… ç”¨æˆ·æ—…ç¨‹åˆ†æ (`assets/journey-tracking.js`)
- **åŠŸèƒ½**: å®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºè·¯å¾„åˆ†æ
- **è¿½è¸ªæŒ‡æ ‡**:
  - ç”¨æˆ·ç»†åˆ†å’Œä¼šè¯ç®¡ç†
  - è½¬åŒ–æ¼æ–—åˆ†æ
  - å‚ä¸åº¦è¯„åˆ†ç³»ç»Ÿ
  - é€€å‡ºæ„å›¾æ£€æµ‹
  - æ¥æºåˆ†æ

### 6. âœ… å†…å®¹å¥åº·åº¦è¯„åˆ†ç³»ç»Ÿ (`assets/content-health-scoring.js`)
- **åŠŸèƒ½**: åŸºäºå¤šç»´åº¦æŒ‡æ ‡çš„å†…å®¹è´¨é‡è¯„ä¼°
- **è¯„ä¼°ç»´åº¦**:
  - å¯è¯»æ€§åˆ†æ (å¥å­é•¿åº¦ã€è¯æ±‡å¤æ‚åº¦)
  - å¯è®¿é—®æ€§æ£€æŸ¥ (alt æ–‡æœ¬ã€æ ‡é¢˜ç»“æ„)
  - æ€§èƒ½è¯„åˆ† (åŠ è½½æ—¶é—´ã€èµ„æºå¤§å°)
  - SEO ä¼˜åŒ–è¯„ä¼° (å…ƒæ ‡ç­¾ã€ç»“æ„åŒ–æ•°æ®)
  - ç”¨æˆ·ä½“éªŒè¯„åˆ† (ç§»åŠ¨å‹å¥½æ€§ã€ç‚¹å‡»ç›®æ ‡)

### 7. âœ… æœåŠ¡ç«¯è¿½è¸ªé›†æˆ
- **API ç«¯ç‚¹**: `/api/track.js`
- **å®¢æˆ·ç«¯**: `assets/server-tracking.js`
- **åŠŸèƒ½**:
  - æ‰¹é‡äº‹ä»¶æ”¶é›†å’Œå‘é€
  - æœåŠ¡ç«¯æ•°æ®å¢å¼º (åœ°ç†ä½ç½®ã€è®¾å¤‡è§£æ)
  - æ•æ„Ÿæ•°æ®è¿‡æ»¤
  - ç¦»çº¿æ”¯æŒå’Œé‡è¯•æœºåˆ¶

### 8. âœ… A/B æµ‹è¯•æ¡†æ¶ (`assets/ab-testing.js`)
- **åŠŸèƒ½**: å®¢æˆ·ç«¯ A/B æµ‹è¯•ç³»ç»Ÿ
- **é¢„ç½®å®éªŒ**:
  - å†™ä½œè¡¨å•å¸ƒå±€ä¼˜åŒ–
  - ä¸»é¡µå†…å®¹é¡ºåºæµ‹è¯•
  - é˜…è¯»ä½“éªŒå¢å¼º
  - ç…§ç‰‡ç”»å»Šå¸ƒå±€æµ‹è¯•
- **ç‰¹æ€§**: ç”¨æˆ·ç»†åˆ†ã€ç¡®å®šæ€§åˆ†é…ã€ç›®æ ‡è½¬åŒ–è¿½è¸ª

### 9. âœ… å¢å¼ºé›†æˆè„šæœ¬
- **ç…§ç‰‡é¡µé¢æ—…ç¨‹è¿½è¸ª**: `assets/photo-journey-tracking.js`
- **å†…å®¹æµè§ˆå¢å¼º**: `assets/content-journey-tracking.js`

## ğŸ§ª å®Œæ•´æµ‹è¯•æŒ‡å—

### A. åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### 1. HTML å±æ€§è¿½è¸ªæµ‹è¯•
```bash
# è®¿é—®ä¸»é¡µï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
# æ£€æŸ¥ Network æ ‡ç­¾é¡µä¸­çš„ Umami è¯·æ±‚

# æµ‹è¯•æ­¥éª¤:
1. ç‚¹å‡»å¯¼èˆªé“¾æ¥ â†’ æ£€æŸ¥ "nav_click" äº‹ä»¶
2. ç‚¹å‡» RSS é“¾æ¥ â†’ æ£€æŸ¥ "rss_click" äº‹ä»¶
3. ç‚¹å‡»ç…§ç‰‡ â†’ æ£€æŸ¥ "photo_full_view" äº‹ä»¶
4. åˆ‡æ¢è¯­è¨€ â†’ æ£€æŸ¥ "language_switch" äº‹ä»¶
```

#### 2. è¡¨å•è¿½è¸ªæµ‹è¯•
```bash
# è®¿é—® /write-note/ é¡µé¢

# æµ‹è¯•æ­¥éª¤:
1. è¿›å…¥é¡µé¢ â†’ æ£€æŸ¥ "form_start" äº‹ä»¶
2. åœ¨å†…å®¹æ¡†è¾“å…¥æ–‡å­— â†’ æ£€æŸ¥ "form_field_focus" äº‹ä»¶
3. é€‰æ‹©æ ‡ç­¾ â†’ æ£€æŸ¥ "form_tag_selection" äº‹ä»¶
4. æŸ¥çœ‹é¢„è§ˆ â†’ æ£€æŸ¥ "form_preview_view" äº‹ä»¶
5. æäº¤è¡¨å• â†’ æ£€æŸ¥ "form_submit_attempt" äº‹ä»¶
```

#### 3. æ—…ç¨‹åˆ†ææµ‹è¯•
```bash
# åœ¨ä»»æ„é¡µé¢æ‰“å¼€æ§åˆ¶å°ï¼Œè¾“å…¥:
console.log(window.journeyTracker.getJourneySummary())

# éªŒè¯è¾“å‡ºåŒ…å«:
- sessionId, userId
- engagementScore, engagementLevel
- conversionGoals, userSegments
- currentFunnel, funnelStep
```

#### 4. å†…å®¹å¥åº·åº¦æµ‹è¯•
```bash
# åœ¨å†…å®¹é¡µé¢æ‰“å¼€æ§åˆ¶å°ï¼Œè¾“å…¥:
console.log(window.contentHealthScorer.getCurrentHealthScore())

# éªŒè¯è¾“å‡ºåŒ…å«:
- overallScore, category
- metrics (readability, accessibility, performance, seo, userExperience)
- recommendations
```

#### 5. A/B æµ‹è¯•éªŒè¯
```bash
# åœ¨ä»»æ„é¡µé¢æ‰“å¼€æ§åˆ¶å°ï¼Œè¾“å…¥:
console.log(window.abTestManager.getCurrentExperiments())

# éªŒè¯å®éªŒåˆ†é…å’Œå˜ä½“åº”ç”¨
# æ£€æŸ¥ DOM ä¸­çš„ data-ab-* å±æ€§
```

### B. æœåŠ¡ç«¯è¿½è¸ªæµ‹è¯•

#### 1. API å¥åº·æ£€æŸ¥
```bash
# è®¿é—® API ç«¯ç‚¹
curl https://site.bazinga.ink/api/track

# é¢„æœŸå“åº”:
{
  "service": "Server-side Umami tracking for Jekyll",
  "status": "healthy",
  "timestamp": "2025-01-01T00:00:00.000Z",
  "umami_configured": false
}
```

#### 2. äº‹ä»¶å‘é€æµ‹è¯•
```bash
# åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ:
window.trackToServer('test_event', { test_data: 'hello' })

# æ£€æŸ¥ Network æ ‡ç­¾é¡µä¸­çš„ POST /api/track è¯·æ±‚
# éªŒè¯å“åº”: {"success": true, "processed": 1}
```

### C. æ€§èƒ½å½±å“è¯„ä¼°

#### 1. é¡µé¢åŠ è½½æ€§èƒ½
```bash
# ä½¿ç”¨ Lighthouse æµ‹è¯•ä¸»è¦é¡µé¢:
- ä¸»é¡µ (/)
- å†™ä½œé¡µé¢ (/write-note/)
- ç…§ç‰‡é¡µé¢ (/photos/)
- å†…å®¹é¡µé¢ (/notes/)

# éªŒè¯æ€§èƒ½è¯„åˆ†ä¿æŒåœ¨ 90+ åˆ†
```

#### 2. JavaScript åŒ…å¤§å°æ£€æŸ¥
```bash
# åœ¨ Network æ ‡ç­¾é¡µæ£€æŸ¥ JavaScript æ–‡ä»¶å¤§å°:
- journey-tracking.js (~15KB)
- content-health-scoring.js (~12KB)
- performance-tracking.js (~10KB)
- ab-testing.js (~8KB)
- server-tracking.js (~6KB)

# æ€»å¢åŠ  ~51KBï¼Œåœ¨åˆç†èŒƒå›´å†…
```

## ğŸ“Š Umami æ•°æ®ç»“æ„ç¤ºä¾‹

### äº‹ä»¶ç±»å‹æ€»è§ˆ (50+ ç§äº‹ä»¶)

#### åŸºç¡€å¯¼èˆªäº‹ä»¶
- `nav_click` - å¯¼èˆªç‚¹å‡»
- `footer_source_click` - é¡µè„šé“¾æ¥ç‚¹å‡»
- `language_switch` - è¯­è¨€åˆ‡æ¢

#### å†…å®¹äº¤äº’äº‹ä»¶
- `photo_full_view` - ç…§ç‰‡æŸ¥çœ‹
- `content_filter` - å†…å®¹ç­›é€‰
- `tag_click` - æ ‡ç­¾ç‚¹å‡»

#### è¡¨å•ç›¸å…³äº‹ä»¶
- `form_start` - è¡¨å•å¼€å§‹
- `form_submit_attempt` - è¡¨å•æäº¤å°è¯•
- `form_submit_success` - è¡¨å•æäº¤æˆåŠŸ

#### æ—…ç¨‹åˆ†æäº‹ä»¶
- `journey_page_entry` - é¡µé¢è¿›å…¥
- `journey_conversion_goal` - è½¬åŒ–ç›®æ ‡è¾¾æˆ
- `journey_exit_intent` - é€€å‡ºæ„å›¾æ£€æµ‹

#### å†…å®¹å¥åº·åº¦äº‹ä»¶
- `content_readability_analysis` - å¯è¯»æ€§åˆ†æ
- `content_accessibility_analysis` - å¯è®¿é—®æ€§åˆ†æ
- `content_final_health_report` - æœ€ç»ˆå¥åº·åº¦æŠ¥å‘Š

#### A/B æµ‹è¯•äº‹ä»¶
- `ab_test_assignment` - å®éªŒåˆ†é…
- `ab_test_exposure` - å®éªŒæ›å…‰
- `ab_test_conversion` - å®éªŒè½¬åŒ–

#### Stories äº¤äº’äº‹ä»¶
- `stories_view_start` - Stories æŸ¥çœ‹å¼€å§‹
- `stories_interaction` - Stories äº¤äº’
- `stories_session_summary` - Stories ä¼šè¯æ‘˜è¦

#### æ€§èƒ½ç›‘æ§äº‹ä»¶
- `core_web_vital` - æ ¸å¿ƒç½‘ç»œæŒ‡æ ‡
- `performance_summary` - æ€§èƒ½æ‘˜è¦
- `javascript_error` - JavaScript é”™è¯¯

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### Vercel ç¯å¢ƒå˜é‡è®¾ç½®
```bash
# Umami API é›†æˆ (å¯é€‰)
UMAMI_API_TOKEN=your_umami_api_token

# æ•°æ®å­˜å‚¨é€‰é¡¹
KV_URL=your_vercel_kv_url
KV_REST_API_TOKEN=your_kv_token
ANALYTICS_WEBHOOK_URL=your_webhook_url
```

## ğŸš€ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰è¿½è¸ªè„šæœ¬å·²æ­£ç¡®åŠ è½½
- [ ] Umami ç½‘ç«™ ID é…ç½®æ­£ç¡®
- [ ] API ç«¯ç‚¹å¯æ­£å¸¸è®¿é—®
- [ ] A/B æµ‹è¯•å®éªŒé…ç½®åˆç†
- [ ] æ€§èƒ½å½±å“åœ¨å¯æ¥å—èŒƒå›´å†…
- [ ] æ•°æ®éšç§è®¾ç½®ç¬¦åˆè¦æ±‚
- [ ] è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•é€šè¿‡

## ğŸ“ˆ é¢„æœŸåˆ†ææ”¶ç›Š

### æ•°æ®ä¸°å¯Œåº¦æå‡
- **äº‹ä»¶ç±»å‹**: ä»åŸºç¡€é¡µé¢æµè§ˆæ‰©å±•åˆ° 50+ ç§è¯¦ç»†äº‹ä»¶
- **ç”¨æˆ·ç”»åƒ**: å¤šç»´åº¦ç”¨æˆ·ç»†åˆ†å’Œè¡Œä¸ºæ¨¡å¼åˆ†æ
- **å†…å®¹æ´å¯Ÿ**: å†…å®¹è´¨é‡é‡åŒ–è¯„ä¼°å’Œä¼˜åŒ–å»ºè®®

### å†³ç­–æ”¯æŒå¢å¼º
- **è½¬åŒ–æ¼æ–—**: æ¸…æ™°çš„ç”¨æˆ·è½¬åŒ–è·¯å¾„å’Œç“¶é¢ˆè¯†åˆ«
- **A/B æµ‹è¯•**: æ•°æ®é©±åŠ¨çš„åŠŸèƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæå‡
- **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½é—®é¢˜å‘ç°å’Œç”¨æˆ·ä½“éªŒå½±å“è¯„ä¼°

### æŠ€æœ¯æ¶æ„ä¼˜åŠ¿
- **æ¨¡å—åŒ–è®¾è®¡**: å„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **æ¸è¿›å¼åŠ è½½**: ä¸å½±å“é¡µé¢æ€§èƒ½çš„æ™ºèƒ½åŠ è½½ç­–ç•¥
- **éšç§å‹å¥½**: æ•æ„Ÿæ•°æ®è¿‡æ»¤å’Œç”¨æˆ·éšç§ä¿æŠ¤
- **ç¦»çº¿æ”¯æŒ**: ç½‘ç»œå¼‚å¸¸æ—¶çš„æ•°æ®ç¼“å­˜å’Œé‡ä¼ æœºåˆ¶

è¿™ä¸ªå…¨é¢çš„ Umami åˆ†æç³»ç»Ÿç°åœ¨å·²ç»å®Œå…¨é›†æˆåˆ°ä½ çš„ Jekyll ç½‘ç«™ä¸­ï¼Œæä¾›äº†ä¼ä¸šçº§çš„ç”¨æˆ·è¡Œä¸ºåˆ†æèƒ½åŠ›ï¼ğŸ‰